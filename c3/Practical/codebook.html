<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>To begin</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>

<!-- MathJax scripts -->
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h2>To begin</h2>

<p>This script assumes you are in a working directory and the directory path c3/Practical already exists.  The script will create the data folder.</p>

<pre><code class="r">#download data set
url &lt;- &quot;https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip&quot;
path &lt;- file.path(getwd(),&quot;data&quot;)
dPath &lt;- file.path(getwd(),&quot;&quot;)
f &lt;- file.path(&quot;Dataset.zip&quot;)
if (!file.exists(path)) {dir.create(path)}
download.file(url, file.path(path, f))

# unzip the dataset
zipF&lt;- file.path(path, f)
outDir &lt;- file.path(getwd(),&quot;data&quot;)
unzip(zipF,exdir=outDir)
</code></pre>

<h2>Load all the files just downloaded</h2>

<p>For all the required files, import them into your environment as data tables.  You can think of these files as a set of rows and columns that all need to be combined.  Use the readme included in the downloaded files to learn more about what the data contains.</p>

<pre><code class="r"># import all the dataset into variables.
# do some loggiing to understand the data
dtSubjectTrain &lt;- fread(file.path(path, &quot;UCI HAR Dataset/train&quot;, &quot;subject_train.txt&quot;))
dtSubjectTest  &lt;- fread(file.path(path, &quot;UCI HAR Dataset/test&quot; , &quot;subject_test.txt&quot; ))

# not how this data fits together
# checking col widhts and lengths to get some idea
# looking for common dimensions
summary(dtSubjectTest)
</code></pre>

<pre><code>##        V1       
##  Min.   : 2.00  
##  1st Qu.: 9.00  
##  Median :12.00  
##  Mean   :12.99  
##  3rd Qu.:18.00  
##  Max.   :24.00
</code></pre>

<pre><code class="r">summary(dtSubjectTrain)
</code></pre>

<pre><code>##        V1       
##  Min.   : 1.00  
##  1st Qu.: 8.00  
##  Median :19.00  
##  Mean   :17.41  
##  3rd Qu.:26.00  
##  Max.   :30.00
</code></pre>

<pre><code class="r">length(dtSubjectTest$V1)
</code></pre>

<pre><code>## [1] 2947
</code></pre>

<pre><code class="r">length(dtSubjectTrain$V1)
</code></pre>

<pre><code>## [1] 7352
</code></pre>

<pre><code class="r">dtActivityYTrain &lt;- fread(file.path(path, &quot;UCI HAR Dataset/train&quot;, &quot;y_train.txt&quot;))
dtActivityYTest  &lt;- fread(file.path(path, &quot;UCI HAR Dataset/test&quot;, &quot;y_test.txt&quot; ))

dtActivityXTrain &lt;- fread(file.path(path, &quot;UCI HAR Dataset/train&quot;, &quot;X_train.txt&quot;))
dtActivityXTest  &lt;- fread(file.path(path, &quot;UCI HAR Dataset/test&quot;, &quot;X_test.txt&quot; ))


# not knowing this data fits together
# checking col widhts and lengths to get some idea
# looking for common dimensions
length(names(dtActivityYTest))
</code></pre>

<pre><code>## [1] 1
</code></pre>

<pre><code class="r">length(dtActivityXTest$V1)
</code></pre>

<pre><code>## [1] 2947
</code></pre>

<pre><code class="r">length(dtActivityYTrain$V1)
</code></pre>

<pre><code>## [1] 7352
</code></pre>

<h2>Load all the files just downloaded</h2>

<p>I visualize this as a gaint excel spreadsheet.  In that sense you can think of pasting the data from the files into the cells. The order doesn&#39;t really matter so long as you end up the following results.</p>

<p>subjectTrain | activityTrain | Ytrain | Xtrain</p>

<p>subjectTest  | activityTest | Ytest  | Xtest</p>

<p>The feature row number in the features.txt files corespond to the columns found in the X data files.
The labels files numerically matches to the values in the activity column</p>

<pre><code class="r"># the files are a mix of columns and rows

dtActivityTrain &lt;- cbind(dtActivityYTrain, dtActivityXTrain)
dtActivityTest &lt;- cbind(dtActivityYTest, dtActivityXTest)

# a one column data table, label the column subject
dtSubject &lt;- rbind(dtSubjectTrain, dtSubjectTest)
setnames(dtSubject, &quot;V1&quot;, &quot;subject&quot;)

# a one column data table, label the column activityLabel
dtActivity &lt;- rbind(dtActivityTrain,dtActivityTest)
setnames(dtActivity, 1, &quot;activityLabel&quot;)
dt &lt;- cbind(dtSubject, dtActivity);

setkey(dt, subject, activityLabel)

# import file as data table
activityLabels &lt;- fread(file.path(path, &quot;UCI HAR Dataset&quot;, &quot;activity_labels.txt&quot;))

# rename the columns to something descriptive
colnames(activityLabels)[1:2] &lt;- c(&quot;activityLabel&quot;, &quot;activityName&quot;)


# doing same thing for feature labels
# import features file as data table
features  &lt;- fread(file.path(path, &quot;UCI HAR Dataset&quot;, &quot;features.txt&quot; ))

# give helpful column names to the feature data table
colnames(features)[1:2] &lt;- c(&quot;featureNum&quot;, &quot;featureName&quot;)
</code></pre>

<h2>merge in the feature and activity labels so that we can begin the tidy data process.</h2>

<p>as described above we are relating the values in the feature and activity_labels file and inserting the text value names.  This way we can read more easily what the value is.  Another key step in this process is the melt command that transforms the data set so that every value that was in a column has it&#39;s own row.</p>

<pre><code class="r"># regex to pulls out names with mean or std
# the tick here is that featureNum lines up with column number of the data set
features &lt;- features[grepl(&quot;mean\\(\\)|std\\(\\)&quot;, featureName)]
# next we append the letter V to the row number value which matches the data set column names
features$featureCode &lt;- features[, paste0(&quot;V&quot;, featureNum)]
str(dt)
</code></pre>

<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   10299 obs. of  563 variables:
##  $ subject      : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ activityLabel: int  1 1 1 1 1 1 1 1 1 1 ...
##  $ V1           : num  0.282 0.256 0.255 0.343 0.276 ...
##  $ V2           : num  -0.0377 -0.06455 0.00381 -0.01445 -0.02964 ...
##  $ V3           : num  -0.1349 -0.0952 -0.1237 -0.1674 -0.1426 ...
##  $ V4           : num  -0.328 -0.229 -0.275 -0.23 -0.227 ...
##  $ V5           : num  -0.1372 0.0165 0.0131 0.1739 0.1643 ...
##  $ V6           : num  -0.189 -0.26 -0.284 -0.213 -0.123 ...
##  $ V7           : num  -0.405 -0.277 -0.341 -0.283 -0.24 ...
##  $ V8           : num  -0.17679 0.00907 -0.02601 0.14469 0.14029 ...
##  $ V9           : num  -0.199 -0.287 -0.32 -0.238 -0.149 ...
##  $ V10          : num  -0.155 -0.155 -0.176 -0.153 -0.153 ...
##  $ V11          : num  -0.2038 -0.174 -0.1568 -0.0578 -0.0578 ...
##  $ V12          : num  -0.131 -0.157 -0.157 -0.265 -0.117 ...
##  $ V13          : num  0.112 0.112 0.213 0.2 0.2 ...
##  $ V14          : num  0.1567 0.1227 0.1227 0.0736 0.0524 ...
##  $ V15          : num  0.411 0.411 0.448 0.385 0.362 ...
##  $ V16          : num  -0.2154 -0.1227 -0.162 -0.0635 -0.0208 ...
##  $ V17          : num  -0.773 -0.702 -0.736 -0.701 -0.7 ...
##  $ V18          : num  -0.855 -0.796 -0.801 -0.734 -0.738 ...
##  $ V19          : num  -0.702 -0.752 -0.767 -0.715 -0.652 ...
##  $ V20          : num  -0.545 -0.278 -0.435 -0.355 -0.283 ...
##  $ V21          : num  -0.492 -0.213 -0.397 -0.272 -0.174 ...
##  $ V22          : num  -0.341 -0.387 -0.529 -0.484 -0.315 ...
##  $ V23          : num  0.424 0.345 0.308 0.448 0.397 ...
##  $ V24          : num  0.286 0.265 0.483 0.425 0.395 ...
##  $ V25          : num  -0.032 0.1013 -0.0359 -0.0276 0.0022 ...
##  $ V26          : num  -0.591 -0.541 -0.358 -0.517 -0.624 ...
##  $ V27          : num  0.684 0.57 0.378 0.602 0.729 ...
##  $ V28          : num  -0.558 -0.37 -0.288 -0.563 -0.762 ...
##  $ V29          : num  0.349 0.171 0.237 0.392 0.537 ...
##  $ V30          : num  -0.333 -0.272 -0.227 -0.284 -0.11 ...
##  $ V31          : num  0.347 0.315 0.294 0.252 0.103 ...
##  $ V32          : num  0.0217 -0.0187 -0.0563 0.1073 0.1828 ...
##  $ V33          : num  -0.0372 0.0853 0.1708 -0.031 0.0515 ...
##  $ V34          : num  -0.359 -0.297 -0.14 -0.255 -0.295 ...
##  $ V35          : num  0.297 0.32 0.142 0.28 0.311 ...
##  $ V36          : num  -0.1576 -0.2042 0.0377 -0.212 -0.2297 ...
##  $ V37          : num  -0.07461 -0.08232 -0.27592 -0.03173 -0.00925 ...
##  $ V38          : num  -0.125 -0.212 -0.188 -0.196 -0.225 ...
##  $ V39          : num  -0.00927 -0.06009 -0.07997 -0.15839 -0.18415 ...
##  $ V40          : num  0.247 0.239 0.28 0.447 0.504 ...
##  $ V41          : num  0.945 0.941 0.946 0.952 0.947 ...
##  $ V42          : num  -0.246 -0.252 -0.264 -0.26 -0.257 ...
##  $ V43          : num  -0.0322 -0.0329 -0.0256 -0.0261 -0.0284 ...
##  $ V44          : num  -0.984 -0.984 -0.963 -0.981 -0.977 ...
##  $ V45          : num  -0.929 -0.917 -0.956 -0.964 -0.989 ...
##  $ V46          : num  -0.933 -0.949 -0.972 -0.964 -0.96 ...
##  $ V47          : num  -0.987 -0.986 -0.963 -0.982 -0.976 ...
##  $ V48          : num  -0.934 -0.914 -0.956 -0.968 -0.989 ...
##  $ V49          : num  -0.94 -0.957 -0.974 -0.965 -0.96 ...
##  $ V50          : num  0.88 0.873 0.885 0.885 0.882 ...
##  $ V51          : num  -0.253 -0.253 -0.27 -0.273 -0.274 ...
##  $ V52          : num  -0.0242 -0.0315 -0.0274 -0.0274 -0.027 ...
##  $ V53          : num  0.961 0.953 0.953 0.963 0.961 ...
##  $ V54          : num  -0.248 -0.244 -0.244 -0.244 -0.231 ...
##  $ V55          : num  -0.0477 -0.0477 -0.0316 -0.0333 -0.0333 ...
##  $ V56          : num  -0.317 -0.307 -0.283 -0.282 -0.293 ...
##  $ V57          : num  0.852 0.841 0.855 0.871 0.857 ...
##  $ V58          : num  -0.899 -0.894 -0.883 -0.887 -0.89 ...
##  $ V59          : num  -0.997 -0.997 -0.998 -0.998 -0.998 ...
##  $ V60          : num  -0.994 -0.991 -0.961 -0.984 -0.978 ...
##  $ V61          : num  -0.95 -0.91 -0.95 -0.978 -0.992 ...
##  $ V62          : num  -0.95 -0.979 -0.979 -0.966 -0.957 ...
##  $ V63          : num  -1 -0.817 -0.817 -1 -1 ...
##  $ V64          : num  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
##  $ V65          : num  -1 -1 -1 -1 -1 ...
##  $ V66          : num  -0.315 -0.358 -0.463 -0.393 -0.401 ...
##  $ V67          : num  0.407 0.431 0.534 0.472 0.474 ...
##  $ V68          : num  -0.497 -0.502 -0.603 -0.549 -0.544 ...
##  $ V69          : num  0.583 0.57 0.671 0.623 0.611 ...
##  $ V70          : num  -0.0998 -0.0682 -0.1186 -0.107 0.0477 ...
##  $ V71          : num  0.1292 0.1135 0.1444 0.1531 0.0289 ...
##  $ V72          : num  -0.223 -0.226 -0.233 -0.263 -0.177 ...
##  $ V73          : num  0.342 0.364 0.345 0.396 0.346 ...
##  $ V74          : num  -0.607 -0.493 -0.329 -0.381 -0.379 ...
##  $ V75          : num  0.623 0.523 0.354 0.41 0.409 ...
##  $ V76          : num  -0.637 -0.552 -0.375 -0.438 -0.437 ...
##  $ V77          : num  0.648 0.577 0.393 0.462 0.46 ...
##  $ V78          : num  -0.873 0.445 0.412 0.665 0.313 ...
##  $ V79          : num  0.2395 -0.6007 0.3203 0.2558 -0.0576 ...
##  $ V80          : num  -0.534 -0.628 0.252 -0.134 0.645 ...
##  $ V81          : num  -0.156 -0.208 0.202 0.336 -0.236 ...
##  $ V82          : num  -0.143 0.358 0.417 -0.464 -0.112 ...
##  $ V83          : num  -0.11308 -0.4524 0.13908 -0.00503 0.17265 ...
##  $ V84          : num  -0.184 -0.108 -0.178 -0.12 -0.192 ...
##  $ V85          : num  -0.1705 -0.0187 -0.0296 0.0287 0.054 ...
##  $ V86          : num  -0.614 -0.548 -0.58 -0.521 -0.469 ...
##  $ V87          : num  -0.2103 -0.0283 -0.1098 -0.0858 -0.1751 ...
##  $ V88          : num  -0.1404 0.067 0.0273 0.0867 0.0703 ...
##  $ V89          : num  -0.593 -0.506 -0.552 -0.473 -0.459 ...
##  $ V90          : num  -0.369 -0.369 -0.355 -0.306 -0.306 ...
##  $ V91          : num  -0.547 -0.473 -0.473 -0.392 -0.392 ...
##  $ V92          : num  -0.81 -0.764 -0.764 -0.694 -0.691 ...
##  $ V93          : num  0.0963 0.1249 0.0814 0.0625 0.0625 ...
##  $ V94          : num  0.3981 0.3048 0.3048 0.2666 0.0922 ...
##  $ V95          : num  0.473 0.467 0.467 0.527 0.233 ...
##  $ V96          : num  -0.282 -0.116 -0.175 -0.122 -0.158 ...
##  $ V97          : num  -0.664 -0.6 -0.659 -0.61 -0.671 ...
##   [list output truncated]
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; 
##  - attr(*, &quot;sorted&quot;)= chr  &quot;subject&quot; &quot;activityLabel&quot;
</code></pre>

<pre><code class="r"># convert the featureCode field to a Vector
select &lt;- c(key(dt), features$featureCode)
# use the vector to select from the data set the matching columns
dt &lt;- dt[, select, with=FALSE]
# we now have only the measurements on the mean and standard deviation
str(dt)
</code></pre>

<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   10299 obs. of  68 variables:
##  $ subject      : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ activityLabel: int  1 1 1 1 1 1 1 1 1 1 ...
##  $ V1           : num  0.282 0.256 0.255 0.343 0.276 ...
##  $ V2           : num  -0.0377 -0.06455 0.00381 -0.01445 -0.02964 ...
##  $ V3           : num  -0.1349 -0.0952 -0.1237 -0.1674 -0.1426 ...
##  $ V4           : num  -0.328 -0.229 -0.275 -0.23 -0.227 ...
##  $ V5           : num  -0.1372 0.0165 0.0131 0.1739 0.1643 ...
##  $ V6           : num  -0.189 -0.26 -0.284 -0.213 -0.123 ...
##  $ V41          : num  0.945 0.941 0.946 0.952 0.947 ...
##  $ V42          : num  -0.246 -0.252 -0.264 -0.26 -0.257 ...
##  $ V43          : num  -0.0322 -0.0329 -0.0256 -0.0261 -0.0284 ...
##  $ V44          : num  -0.984 -0.984 -0.963 -0.981 -0.977 ...
##  $ V45          : num  -0.929 -0.917 -0.956 -0.964 -0.989 ...
##  $ V46          : num  -0.933 -0.949 -0.972 -0.964 -0.96 ...
##  $ V81          : num  -0.156 -0.208 0.202 0.336 -0.236 ...
##  $ V82          : num  -0.143 0.358 0.417 -0.464 -0.112 ...
##  $ V83          : num  -0.11308 -0.4524 0.13908 -0.00503 0.17265 ...
##  $ V84          : num  -0.184 -0.108 -0.178 -0.12 -0.192 ...
##  $ V85          : num  -0.1705 -0.0187 -0.0296 0.0287 0.054 ...
##  $ V86          : num  -0.614 -0.548 -0.58 -0.521 -0.469 ...
##  $ V121         : num  -0.47973 0.09409 0.2112 0.09608 0.00874 ...
##  $ V122         : num  0.082 -0.3092 -0.2729 -0.1634 0.0117 ...
##  $ V123         : num  0.25644 0.08644 0.10199 0.02586 0.00417 ...
##  $ V124         : num  -0.324 -0.399 -0.445 -0.36 -0.378 ...
##  $ V125         : num  -0.1419 -0.0884 -0.0631 0.0423 0.1337 ...
##  $ V126         : num  -0.457 -0.402 -0.347 -0.276 -0.308 ...
##  $ V161         : num  0.0942 0.1667 -0.1632 -0.0546 -0.0757 ...
##  $ V162         : num  -0.47621 -0.0338 -0.00556 0.34029 0.17147 ...
##  $ V163         : num  -0.1421 -0.0893 -0.2316 -0.2697 0.1365 ...
##  $ V164         : num  -0.346 -0.25 -0.264 -0.102 -0.129 ...
##  $ V165         : num  -0.487 -0.454 -0.425 -0.243 -0.19 ...
##  $ V166         : num  -0.422 -0.37 -0.343 -0.312 -0.418 ...
##  $ V201         : num  -0.2246 -0.1265 -0.1601 -0.0735 -0.0495 ...
##  $ V202         : num  -0.238 -0.213 -0.258 -0.195 -0.211 ...
##  $ V214         : num  -0.2246 -0.1265 -0.1601 -0.0735 -0.0495 ...
##  $ V215         : num  -0.238 -0.213 -0.258 -0.195 -0.211 ...
##  $ V227         : num  -0.289 -0.139 -0.194 -0.129 -0.16 ...
##  $ V228         : num  -0.165 -0.199 -0.22 -0.174 -0.15 ...
##  $ V240         : num  -0.0344 -0.1409 -0.0946 -0.0493 -0.0214 ...
##  $ V241         : num  -0.1682 -0.2161 -0.2908 -0.0901 -0.0446 ...
##  $ V253         : num  -0.466 -0.39 -0.374 -0.236 -0.22 ...
##  $ V254         : num  -0.434 -0.439 -0.418 -0.229 -0.213 ...
##  $ V266         : num  -0.261 -0.151 -0.23 -0.151 -0.226 ...
##  $ V267         : num  -0.1226 -0.029 0.0254 0.1953 0.1103 ...
##  $ V268         : num  -0.331 -0.257 -0.377 -0.321 -0.205 ...
##  $ V269         : num  -0.357 -0.262 -0.294 -0.263 -0.227 ...
##  $ V270         : num  -0.1996 -0.0239 -0.0577 0.0879 0.1188 ...
##  $ V271         : num  -0.178 -0.322 -0.29 -0.217 -0.146 ...
##  $ V345         : num  -0.21 -0.178 -0.193 -0.183 -0.285 ...
##  $ V346         : num  -0.2635 -0.1208 -0.1096 -0.026 -0.0111 ...
##  $ V347         : num  -0.536 -0.499 -0.526 -0.487 -0.426 ...
##  $ V348         : num  -0.228 -0.114 -0.236 -0.132 -0.169 ...
##  $ V349         : num  -0.12427 0.02785 -0.00582 0.02037 0.05578 ...
##  $ V350         : num  -0.698 -0.595 -0.633 -0.553 -0.51 ...
##  $ V424         : num  -0.185 -0.205 -0.317 -0.162 -0.237 ...
##  $ V425         : num  -0.198 -0.2458 -0.2082 0.0266 0.0472 ...
##  $ V426         : num  -0.308 -0.311 -0.186 -0.18 -0.258 ...
##  $ V427         : num  -0.368 -0.461 -0.486 -0.423 -0.422 ...
##  $ V428         : num  -0.11505 -0.00984 0.00973 0.04465 0.17602 ...
##  $ V429         : num  -0.565 -0.49 -0.469 -0.377 -0.389 ...
##  $ V503         : num  -0.1668 -0.0793 -0.1563 -0.1044 -0.1232 ...
##  $ V504         : num  -0.4 -0.423 -0.437 -0.376 -0.388 ...
##  $ V516         : num  -0.154 -0.178 -0.149 -0.132 -0.116 ...
##  $ V517         : num  -0.185 -0.231 -0.321 -0.233 -0.201 ...
##  $ V529         : num  -0.22218 -0.26828 -0.30867 -0.06013 -0.00382 ...
##  $ V530         : num  -0.274 -0.315 -0.401 -0.275 -0.246 ...
##  $ V542         : num  -0.432 -0.428 -0.401 -0.218 -0.188 ...
##  $ V543         : num  -0.476 -0.493 -0.482 -0.299 -0.3 ...
##  - attr(*, &quot;sorted&quot;)= chr  &quot;subject&quot; &quot;activityLabel&quot;
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;
</code></pre>

<pre><code class="r"># using the column label activityLabel we join the Descriptive names matching the numeric values
dt &lt;- merge(dt, activityLabels, by=&quot;activityLabel&quot;, all.x=TRUE)
setkey(dt, subject, activityLabel, activityName)

# melt transforms the table using the set keys above.
dt &lt;- data.table(melt(dt, key(dt), variable.name=&quot;featureCode&quot;))
# so now every value that was in a column has it&#39;s own row
# now we add the feature number and feature name using merge
dt &lt;- merge(dt, features[, list(featureNum, featureCode, featureName)], by=&quot;featureCode&quot;, all.x=TRUE)
# the result replaces the difficult to read Vnum which was the original value of the column heading
# with a more readable name and reference number

# addes new column with factors from the given column
dt$activity &lt;- factor(dt$activityName)
dt$feature &lt;- factor(dt$featureName)
</code></pre>

<h2>This next step in a more involved process of cleaning up the names.</h2>

<p>There are 66 unique feature names, however, they are long and encoded with various meaning that is hard to read or understand.  Using Regex we go through and caterogize them further by adding new columns tht decode the meanings of the names in feature column.</p>

<pre><code class="r"># addes new column with factors from the given column
dt$activity &lt;- factor(dt$activityName)
dt$feature &lt;- factor(dt$featureName)

# define function to apply regex search
grepthis &lt;- function (regex) {
  grepl(regex, dt$feature)
}
# Clean up the data one step further by group the features by common properties
n &lt;- 2
y &lt;- matrix(seq(1, n), nrow=n)
# go through all the feature names if it starts with the let t label as time
# if it starts with letter f, label as Freq
x &lt;- matrix(c(grepthis(&quot;^t&quot;), grepthis(&quot;^f&quot;)), ncol=nrow(y))
dt$featDomain &lt;- factor(x %*% y, labels=c(&quot;Time&quot;, &quot;Freq&quot;))

# label the Instrument type as either Accelerometer or Gyroscope by matching
# Acc or Gryo any place in the feature name
x &lt;- matrix(c(grepthis(&quot;Acc&quot;), grepthis(&quot;Gyro&quot;)), ncol=nrow(y))
dt$featInstrument &lt;- factor(x %*% y, labels=c(&quot;Accelerometer&quot;, &quot;Gyroscope&quot;))

# label Acceleartion by either Body/Gravity using the pattern passed into grepthis
x &lt;- matrix(c(grepthis(&quot;BodyAcc&quot;), grepthis(&quot;GravityAcc&quot;)), ncol=nrow(y))
dt$featAcceleration &lt;- factor(x %*% y, labels=c(NA, &quot;Body&quot;, &quot;Gravity&quot;))

# label mean() / std() as Mean or SD
x &lt;- matrix(c(grepthis(&quot;mean()&quot;), grepthis(&quot;std()&quot;)), ncol=nrow(y))
dt$featVariable &lt;- factor(x %*% y, labels=c(&quot;Mean&quot;, &quot;SD&quot;))

# label feature names containing Jerk as either NA or Jerk
dt$featJerk &lt;- factor(grepthis(&quot;Jerk&quot;), labels=c(NA, &quot;Jerk&quot;))

# label features with Mag in name as Magnitude
dt$featMagnitude &lt;- factor(grepthis(&quot;Mag&quot;), labels=c(NA, &quot;Magnitude&quot;))

n &lt;- 3
y &lt;- matrix(seq(1, n), nrow=n)
# using the matrix y create a vector of the grep results
x &lt;- matrix(c(grepthis(&quot;-X&quot;), grepthis(&quot;-Y&quot;), grepthis(&quot;-Z&quot;)), ncol=nrow(y))
# with the grep result matix us this to label the feature as either X,Y or Z
dt$featAxis &lt;- factor(x %*% y, labels=c(NA, &quot;X&quot;, &quot;Y&quot;, &quot;Z&quot;))

# lets make sure that we didn&#39;t miss any features.
# count the number of unique feature names in the features colunm
r1 &lt;- nrow(dt[, .N, by=c(&quot;feature&quot;)])
# count the number of unqiue feature names we just created in the new columns
r2 &lt;- nrow(dt[, .N, by=c(&quot;featDomain&quot;, &quot;featAcceleration&quot;, &quot;featInstrument&quot;, &quot;featJerk&quot;, &quot;featMagnitude&quot;, &quot;featVariable&quot;, &quot;featAxis&quot;)])
r1 == r2
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<pre><code class="r"># they are equal so we feel good
</code></pre>

<h2>Create final tidy data set</h2>

<p>Finally we select out the data values using the new labels and preform count and aveage operations.</p>

<pre><code class="r"># now set a key for the data table on each of the new columns that have awesome new names
setkey(dt, subject, activity, featDomain, featAcceleration, featInstrument, featJerk, featMagnitude, featVariable, featAxis)

# then use the key list to make a new table that has the average and total number or rows (count)
Tidy &lt;- dt[, list(count = .N, average = mean(value)), by=key(dt)]
# the result is a table with a tidy data set?
summary(Tidy)
</code></pre>

<pre><code>##     subject                   activity    featDomain  featAcceleration
##  Min.   : 1.0   LAYING            :1980   Time:7200   NA     :4680    
##  1st Qu.: 8.0   SITTING           :1980   Freq:4680   Body   :5760    
##  Median :15.5   STANDING          :1980               Gravity:1440    
##  Mean   :15.5   WALKING           :1980                               
##  3rd Qu.:23.0   WALKING_DOWNSTAIRS:1980                               
##  Max.   :30.0   WALKING_UPSTAIRS  :1980                               
##        featInstrument featJerk      featMagnitude  featVariable featAxis 
##  Accelerometer:7200   NA  :7200   NA       :8640   Mean:5940    NA:3240  
##  Gyroscope    :4680   Jerk:4680   Magnitude:3240   SD  :5940    X :2880  
##                                                                 Y :2880  
##                                                                 Z :2880  
##                                                                          
##                                                                          
##      count          average        
##  Min.   :36.00   Min.   :-0.99767  
##  1st Qu.:49.00   1st Qu.:-0.96205  
##  Median :54.50   Median :-0.46989  
##  Mean   :57.22   Mean   :-0.48436  
##  3rd Qu.:63.25   3rd Qu.:-0.07836  
##  Max.   :95.00   Max.   : 0.97451
</code></pre>

<pre><code class="r"># write the tidy data set to a file
write.csv(Tidy, &quot;tidy.csv&quot;, row.names=FALSE)
</code></pre>

</body>

</html>
